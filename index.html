<script src="/lib.js"></script>
<script src="/config.js"></script>
<script>
    const form = document.getElementById('proxy-form');
    form.onsubmit = async (e) => {
        e.preventDefault();
        const input = document.getElementById('url-input').value;
        if (!input) return;

        const targetUrl = input.startsWith('http') ? input : 'https://' + input;

        if ('serviceWorker' in navigator) {
            try {
                // sw.js は直下にあるので '/sw.js'
                await navigator.serviceWorker.register('/sw.js', { scope: '/service/' });
                await navigator.serviceWorker.ready;

                setTimeout(() => {
                    window.location.href = '/service/' + __uv$config.encodeUrl(targetUrl);
                }, 300);
            } catch (err) {
                alert('SW Error: ' + err);
            }
        }
    };
</script>
