<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>purokusiiiii-V4</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        /* 1. ç„¼ãé³¥ãƒãƒŠãƒ¼ */
        #banner { width: 100vw; height: 100vh; background: url('/IMG_0676.jpg') no-repeat center/cover; position: relative; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 10vh; }
        .btn { background: #e11d48; color: white; padding: 20px 40px; font-size: 1.5rem; border-radius: 10px; cursor: pointer; border: 4px solid #fff; font-weight: bold; }
        /* 2. èªè¨¼ãƒ»å…¥åŠ›ç”»é¢ */
        #ui { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #020617; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        input { font-size: 1.5rem; padding: 15px; width: 80%; max-width: 400px; text-align: center; background: #1e293b; color: #fff; border: 2px solid #334155; border-radius: 10px; margin-bottom: 20px; outline: none; }
        /* 3. å½è©æ¬ºç”»é¢ */
        #panic { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; color: #f00; z-index: 200; padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <div id="banner"><div class="btn" onclick="showUI()">ãŠç”³ã—è¾¼ã¿ã¯ã“ã¡ã‚‰</div></div>

    <div id="ui">
        <h1 id="title">ç®¡ç†è€…èªè¨¼</h1>
        <p id="hint" style="color:#64748b;">ãƒ’ãƒ³ãƒˆï¼šğŸ£</p>
        <input type="password" id="inputBox" placeholder="****">
        <button id="mainBtn" onclick="action()" style="padding:15px 50px; background:#38bdf8; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">å®Ÿè¡Œ</button>
    </div>

    <div id="panic">
        <h1 style="border:8px solid #f00; padding:20px;">ç™»éŒ²å®Œäº†è‡´ãƒ¬ã¾ï¼µãŸã€‚</h1>
        <p>è«‹æ±‚é‡‘é¡ï¼šï¿¥98,000å††</p>
        <button onclick="location.reload()">æˆ»ã‚‹</button>
    </div>

    <script>
        let isUnlocked = localStorage.getItem('purokusiiiii_unlocked') === 'true';
        const config = {
            prefix: '/api/bare?url=',
            encodeUrl: (u) => btoa(unescape(encodeURIComponent(u))).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '')
        };

        // ãƒ­ã‚°ã‚¤ãƒ³æ¶ˆã•ãšã«æƒé™¤
        window.onload = async () => {
            if ('serviceWorker' in navigator) {
                const regs = await navigator.serviceWorker.getRegistrations();
                for (let r of regs) await r.unregister();
            }
        };

        function showUI() {
            document.getElementById('ui').style.display = 'flex';
            if(isUnlocked) setupInput();
        }

        function setupInput() {
            document.getElementById('title').innerText = 'purokusiiiii';
            document.getElementById('hint').style.display = 'none';
            const box = document.getElementById('inputBox');
            box.type = 'text';
            box.placeholder = 'https://...';
            box.value = '';
        }

        function action() {
            const val = document.getElementById('inputBox').value;
            if(!isUnlocked) {
                if(val === '1225') {
                    isUnlocked = true;
                    localStorage.setItem('purokusiiiii_unlocked', 'true');
                    setupInput();
                } else {
                    document.getElementById('ui').style.display = 'none';
                    document.getElementById('panic').style.display = 'block';
                }
            } else {
                let url = val.trim();
                if(!url) return;
                if(!url.startsWith('http')) url = 'https://' + url;
                location.href = config.prefix + config.encodeUrl(url);
            }
        }
    </script>
</body>
</html>
